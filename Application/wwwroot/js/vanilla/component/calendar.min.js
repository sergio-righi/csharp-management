(function(n,t){typeof define=="function"&&define.amd?define(t):typeof exports=="object"?module.exports=t():n.calendar=t()})(this,function(){function r(n){return dataStorage.get(n,"calendar")}function n(n,t){this.dates=[];this.exception=[];this.lastWeekday=6;this.firstWeekday=0;this.today=new Date;this.selectedElement=null;this.month=this.today.getMonth();this.year=this.today.getFullYear();var i={min:null,max:null,today:!0,categories:[{category:-1,cls:"black"}],weekend:!0,selected:null,overflow:!0,weekday:"short",description:!0,locale:window.navigator.language};this.calendar=n;this.options=p({},i,t);this.init()}function u(){let n=document.createElement("div");n.className="calendar-header";this.arrowLeft=document.createElement("span");this.arrowLeft.className="header-left";let t=document.createElement("div");t.className="header-label";this.calendarMonth=document.createElement("span");this.calendarMonth.className="header-month";this.calendarYear=document.createElement("span");this.calendarYear.className="header-year";this.arrowRight=document.createElement("span");this.arrowRight.className="header-right";t.appendChild(this.calendarMonth);t.appendChild(this.calendarYear);n.appendChild(this.arrowLeft);n.appendChild(t);n.appendChild(this.arrowRight);let i=document.createElement("div");i.className="calendar-content";i.innerHTML=f.call(this);this.calendarDate=document.createElement("div");this.calendarDate.className="calendar-month";i.appendChild(this.calendarDate);this.calendar.appendChild(n);this.calendar.appendChild(i);this.options.description&&(this.calendarFooter=document.createElement("div"),this.calendarFooter.className="calendar-footer",this.calendarFooterClose=document.createElement("div"),this.calendarFooterClose.className="calendar-footer-icon",this.calendarFooterHeader=document.createElement("div"),this.calendarFooterHeader.className="calendar-footer-header",this.calendarFooterContent=document.createElement("div"),this.calendarFooterContent.className="calendar-footer-content",this.calendarFooter.appendChild(this.calendarFooterClose),this.calendarFooter.appendChild(this.calendarFooterHeader),this.calendarFooter.appendChild(this.calendarFooterContent),this.calendar.appendChild(this.calendarFooter))}function f(){let n=y.call(this),t=['<div class="calendar-weekday">'];for(let i=this.firstWeekday;i<=this.lastWeekday;i++)t.push(`<div class="item">${n.toLocaleString(this.options.locale,{weekday:this.options.weekday}).toUpperCase()}</div>`),n.setDate(n.getDate()+1);return t.push("<\/div>"),t.join("")}function e(n,t){let i=document.createElement("div");i.classList="item";i.textContent=n.getUTCDate();const r=n.getMonth()!==this.month||this.exception.isException(n)?!0:!n.inRange(this.options.min,this.options.max);if(r)i.classList.add("disabled");else{this.options.today&&n.compareTo(this.today)&&(i.classList.add("today"),this.selectedElement=i);this.options.selected!==null&&n.compareTo(this.options.selected)&&(i.classList.add("selected"),this.selectedElement=i);let r=t.getEventByDate(n);r.length>0&&(i.setAttribute("data-quantity",r.length),i.classList.add("highlight"));const u=r.getCategory();if(u.length>0){let n=['<div class="group">'];[].forEach.call(u,function(t){n.push(`<div class="category bg-${t}"></div>`)});n.push("<\/div>");i.innerHTML+=n.join("")}}return i.outerHTML}function t(){let n=[];const t=v.call(this),r=this.dates.getEventByPeriod(this.month,this.year),i=this.options.min!==null&&t[0]<=this.options.min?!0:!1,u=this.options.max!==null&&t[t.length-1]>=this.options.max?!0:!1;for(let u=0;u<t.length;u++){const o=t[u],f=t[u].getDay();if(!this.options.overflow&&u===0&&f!==this.firstWeekday){n.push('<div class="calendar-week">');for(let t=this.firstWeekday;t<f;t++)n.push('<div class="item disabled"><\/div>')}u===0&&i?this.arrowLeft.classList.add("disabled"):i||this.arrowLeft.classList.remove("disabled");f===this.firstWeekday&&n.push('<div class="calendar-week">');n.push(e.call(this,o,r));f===this.lastWeekday&&n.push("<\/div>")}if(!this.options.overflow&&date.getDay()!==this.lastWeekday){for(let t=date.getDay();t<this.lastWeekday;t++)n.push('<div class="item disabled"><\/div>');n.push("<\/div>")}return u?this.arrowRight.classList.add("disabled"):this.arrowRight.classList.remove("disabled"),this.calendarMonth.innerHTML=new Date(this.year,this.month,1).toLocaleString(this.options.locale,{month:"long"}),this.calendarYear.innerHTML=this.year,this.calendarDate.innerHTML=n.join(""),this}function o(){this._events={dateClick:h.bind(this),arrowClick:c.bind(this),closeClick:l.bind(this)};this.arrowLeft.addEventListener("click",this._events.arrowClick.bind(this,"left"));this.arrowRight.addEventListener("click",this._events.arrowClick.bind(this,"right"));this.calendar.addEventListener("click",this._events.dateClick);this.options.description&&this.calendarFooterClose.addEventListener("click",this._events.closeClick)}function s(){this.arrowLeft.removeEventListener("click",this._events.arrowClick.bind(this,"left"));this.arrowRight.removeEventListener("click",this._events.arrowClick.bind(this,"right"));this.calendar.removeEventListener("click",this._events.dateClick);this.options.description&&this.calendarFooterClose.removeEventListener("click",this._events.closeClick)}function h(n){if(n.target&&n.target.classList.contains("item")&&!n.target.classList.contains("out")&&!n.target.classList.contains("disabled")){const t=parseInt(n.target.textContent),i=new Date(this.year,this.month,t);this.selectedElement.classList.remove("selected");n.target.classList.add("selected");this.open(i);this.selectedElement=n.target}}function c(n,t){t.target&&!/disabled/.test(t.target.className)&&(n==="left"?this.moveTo(0,11,-1,-1):n==="right"&&this.moveTo(11,0,1,-1))}function l(){this.calendarFooter.classList.remove("active")}function a(){this.options.min!==null?this.options.min.compareTo(new Date)?null:this.options.min.setMonth(this.options.min.getMonth()-1):null;this.options.max!==null?this.options.max.compareTo(new Date)?null:this.options.max.setMonth(this.options.max.getMonth()-1):null;this.options.max!==null&&this.options.max.getMonth()<this.month&&this.options.max.getFullYear()===this.year?this.month=this.options.max.getMonth():null;this.options.weekend||(this.lastWeekday=5,this.firstWeekday=1)}function v(){let i=[],n=new Date(this.year,this.month,1),t=new Date(this.year,this.month+1,0);if(this.options.overflow){while(t.getDay()!==this.lastWeekday)t.setDate(t.getDate()+1);while(n.getDay()!==this.firstWeekday)n.setDate(n.getDate()-1)}while(n<t||n.compareTo(t)){let t=n.getDay();t>=this.firstWeekday&&t<=this.lastWeekday&&i.push(new Date(n));n.setDate(n.getDate()+1)}return i}function y(){let n=new Date;if(n.getDay()!==this.firstWeekday)while(n.getDay()!==this.firstWeekday)n.setDate(n.getDate()-1);return n}function p(){for(var t,n=1;n<arguments.length;n++)for(t in arguments[n])arguments[n].hasOwnProperty(t)&&(arguments[0][t]=arguments[n][t]);return arguments[0]}n.prototype.init=function(){if(this.calendar!==undefined)return a.call(this),u.call(this),o.call(this),t.call(this),dataStorage.put(this.calendar,"calendar",this),this};n.prototype.destroy=function(){this.calendar!==null&&(s.call(this),this.calendar.parentNode.removeChild(this.calendar),this.calendar=null)};n.prototype.add=function(n){if(typeof n.date!="undefined"&&!this.exception.isException(n.date)){const t=this.dates.getEvent(n.id);if(t.index===-1||t.event!==null&&(t.event.category===-1||t.event.category!==n.category)){let r=new Date(n.date),t=new i(n);t.startDate=n.date;t.cls=this.options.categories.getCategoryClass(t.category);do r.inRange(this.options.min,this.options.max)&&(t=new i(t),t.date=new Date(r),this.dates.push(t)),r.setDate(r.getDate()+1);while(r<=n.endDate)}}return this};n.prototype.addException=function(n){return typeof n=="undefined"||this.exception.isException(n)||n.inRange(this.options.min,this.options.max)&&(this.exception.push(n),this.update()),this};n.prototype.remove=function(n){if(typeof n!="undefined"){let t=this.dates.getEvent(n).index;t!==-1&&(this.dates.splice(t,1),this.update())}return this};n.prototype.update=function(){return t.call(this),this};n.prototype.moveTo=function(n,t,i,r){this.month!==n?this.month+=i:(this.month=t,this.year+=i);const u=new Date(this.year,this.month,r);return this.update(),this};n.prototype.open=function(n){if(this.options.selected=n,this.options.description){let t=this.dates.getEventByDate(n);if(t.length>0){let r,i=['<ul class="list list-disorderly">'];for(let n=0;n<t.length;n++)t[n].description!==null&&(t[n].endDate===null||t[n].startDate.compareTo(t[n].endDate)?i.push(`<li class="${t[n].cls}">${t[n].description}</li>`):(r=`(${eventos[n].startDate.toLocaleDateString(this.options.locale,{day:"numeric",month:"numeric",year:"numeric"})} - ${t[n].endDate.toLocaleDateString(this.options.locale,{day:"numeric",month:"numeric",year:"numeric"})})`,i.push(`<li class="${t[n].cls}">${t[n].description}<br/><small>${r}</small></li>`)));i.push("<\/ul>");this.calendarFooterHeader.innerHTML=n.toLocaleDateString(this.options.locale,{day:"numeric",month:"long",year:"numeric"});this.calendarFooterContent.innerHTML=i.join("");this.calendarFooter.classList.add("active")}else t=null}return this.update(),this};let i=function(n){this.id=n.id;this.startDate=null;this.date=n.date;this.cls=typeof n.cls=="undefined"?null:n.cls;this.endDate=typeof n.endDate=="undefined"?null:n.endDate;this.category=typeof n.category=="undefined"?-1:n.category;this.description=typeof n.description=="undefined"?null:n.description};return Date.prototype.compareTo=function(n){return n===null?!1:this.getDate()===n.getDate()&&this.getMonth()===n.getMonth()&&this.getFullYear()===n.getFullYear()},Date.prototype.inRange=function(n,t){return(n===null||this>=n)&&(t===null||this<=t)},Array.prototype.isException=function(n){let t=!1;return[].forEach.call(this,function(i){if(i.compareTo(n))return t=!0,!1}),t},Array.prototype.getEvent=function(n){let t={index:-1,item:null};return[].forEach.call(this,function(i,r){if(i.id===n)return t.index=r,t.item=i,!1}),t},Array.prototype.getEventByPeriod=function(n,t){return Array.prototype.filter.call(this,function(i){if(i.date.getMonth()===n&&i.date.getFullYear()===t)return i})},Array.prototype.getEventByDate=function(n){return Array.prototype.filter.call(this,function(t){if(n.compareTo(t.date))return t})},Array.prototype.getCategoryClass=function(n){let t="";return this.length>0&&[].forEach.call(this,function(i){if(i.category===n)return t=i.cls,!1}),t},Array.prototype.getCategory=function(){let n=[];return[].forEach.call(this,function(t){n.indexOf(t.cls)===-1&&n.push(t.cls)}),n},{init:n,get:r}});