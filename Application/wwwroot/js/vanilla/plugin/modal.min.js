(function(n,t){typeof define=="function"&&define.amd?define(t):typeof exports=="object"?module.exports=t():n.modal=t()})(this,function(){function r(n){return dataStorage.get(n,"modal")}function n(n,t){this.trigger=null;this.modal=n;this.options=v({},{onOpen:null,onClose:null,beforeOpen:null,beforeClose:null,closeMethods:["overlay","button","escape"]},t);this.init()}function u(){this.popup=document.createElement("div");this.popup.className="modal-popup";this.closeButton=document.createElement("button");this.closeButton.setAttribute("type","button");this.closeButton.className="modal-close";l.call(this);this.modal.innerHTML="";this.modal.appendChild(this.closeButton);this.modal.appendChild(this.popup)}function f(){this._events={clickClose:h.bind(this),keyboardNav:o.bind(this),clickOverlay:s.bind(this),triggerButton:c.bind(this)};this.modal.addEventListener("mousedown",this._events.clickOverlay);document.addEventListener("keydown",this._events.keyboardNav);this.closeButton.addEventListener("mouseup",this._events.clickClose);this.buttons=document.querySelectorAll(`[data-modal="#${this.modal.id}"]`);for(let n=0;n<this.buttons.length;n++)this.buttons[n].addEventListener("click",this._events.triggerButton)}function e(){if(this.modal.removeEventListener("mousedown",this._events.clickOverlay),document.removeEventListener("keydown",this._events.keyboardNav),this.closeButton.removeEventListener("mouseup",this._events.clickClose.bind(!0)),this.buttons!==undefined)for(let n=0;n<this.buttons.length;n++)this.buttons[n].removeEventListener("click",this._events.triggerButton)}function o(n){this.options.closeMethods.indexOf("escape")!==-1&&n.which===i.esc&&this.isOpen()&&this.close()}function s(n){this.options.closeMethods.indexOf("overlay")!==-1&&!a(n.target,"modal")&&n.clientX<this.modal.clientWidth&&this.close()}function h(){this.options.closeMethods.indexOf("button")!==-1&&this.close()}function c(n){if(n.target&&n.target.closestAttribute("data-modal")){let t=n.target.closestAttribute("data-modal");t.getAttribute("disabled")===null&&(this.trigger=t,this.open());this.setHeader(t.dataset.header);this.setContent(t.dataset.content);this.setFooter(t.dataset.footer)}}function l(){let n=this.modal.querySelectorAll("[data-header]")[0];n!==undefined&&this.setHeader(n.innerHTML);let t=this.modal.querySelectorAll("[data-content]")[0];t!==undefined&&this.setContent(t.innerHTML);let i=this.modal.querySelectorAll("[data-footer]")[0];i!==undefined&&this.setFooter(i.innerHTML)}function a(n,t){while((n=n.parentElement)&&!n.classList.contains(t));return n}function v(){for(var t,n=1;n<arguments.length;n++)for(t in arguments[n])arguments[n].hasOwnProperty(t)&&(arguments[0][t]=arguments[n][t]);return arguments[0]}const i={esc:27};let t=!1;return n.prototype.init=function(){return u.call(this),f.call(this),dataStorage.put(this.modal,"modal",this),this},n.prototype._busy=function(n){t=n},n.prototype._isBusy=function(){return t},n.prototype.destroy=function(){this.modal!==null&&(this.isOpen()&&this.close(!0),e.call(this),this.modal.parentNode.removeChild(this.modal),this.modal=null)},n.prototype.isOpen=function(){return!!this.modal.classList.contains("active")},n.prototype.open=function(){if(!this._isBusy())return this._busy(!0),typeof this.options.beforeOpen=="function"&&this.options.beforeOpen(),document.body.classList.add("o-hidden"),this.modal.classList.add("active"),typeof this.options.onOpen=="function"&&this.options.onOpen.call(self),this._busy(!1),this},n.prototype.close=function(){if(!this._isBusy()){if(this._busy(!0),typeof this.options.beforeClose=="function"){let n=this.options.beforeClose.call(this);if(!n){this._busy(!1);return}}document.body.classList.remove("o-hidden");this.modal.classList.remove("active");typeof this.options.onClose=="function"&&this.options.onClose.call(this);this._busy(!1)}},n.prototype.setHeader=function(n){return this.header===undefined&&(this.header=document.createElement("div"),this.header.className="modal-header",this.popup.childNodes.length===0?this.popup.appendChild(this.header):this.popup.insertBefore(this.header,this.popup.firstElementChild)),n!==undefined&&(this.header.innerHTML=n),this},n.prototype.setContent=function(n){return this.content===undefined&&(this.content=document.createElement("div"),this.content.className="modal-content",this.header===undefined?this.popup.appendChild(this.content):this.header.parentNode.insertBefore(this.content,this.header.nextSibling)),n!==undefined&&(this.content.innerHTML=n),this},n.prototype.setFooter=function(n){return this.footer===undefined&&(this.footer=document.createElement("div"),this.footer.className="modal-footer",this.popup.appendChild(this.footer)),n!==undefined&&(this.footer.innerHTML=n),this},{init:n,get:r}});